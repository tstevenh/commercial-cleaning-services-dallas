---
import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import Schema from '../components/Schema.astro';
import FAQ from '../components/FAQ.astro';
import ContactForm from '../components/ContactForm';

interface Props {
  title: string;
  description: string;
  city: string;
  county: string;
  targetKeyword: string;
  faqs: Array<{ question: string; answer: string }>;
  relatedServices?: Array<{ slug: string; title: string; description: string }>;
  relatedLocations?: Array<{ slug: string; title: string; description: string }>;
  parentPage?: string;
  heroImage?: string;
}

const {
  title,
  description,
  city,
  county,
  targetKeyword,
  faqs,
  relatedServices = [],
  relatedLocations = [],
  parentPage = 'Locations',
  heroImage
} = Astro.props;

const siteData = (await import('../data/site.json')).default;

const breadcrumbs = [
  { name: 'Home', url: '/' },
  { name: parentPage, url: '/locations' },
  { name: city, url: '#' }
];

// Schema markup for location pages
const locationSchemaData = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  name: siteData.name,
  description: description,
  url: `https://commercialcleaningservicesdallas.com/locations/${city.toLowerCase().replace(/\s+/g, '-')}-tx`,
  telephone: siteData.phone,
  email: siteData.email,
  address: {
    "@type": "PostalAddress",
    streetAddress: siteData.address.street,
    addressLocality: city,
    addressRegion: "TX",
    postalCode: siteData.address.zip,
    addressCountry: "US"
  },
  areaServed: {
    "@type": "City",
    name: city
  },
  priceRange: "$$-$$$"
};
---

<BaseLayout title={title} description={description}>
  <!-- Schema Markup -->
  <Schema type="localBusiness" data={locationSchemaData} />
  <Schema type="faqPage" data={{ faqs }} />
  <Schema type="breadcrumb" data={{ breadcrumbs }} />

  <style is:global>
    /* Override FAQ styling to match homepage */
    .faq-section {
      background: white !important;
      border-top: 2px solid var(--color-black);
      border-bottom: 2px solid var(--color-black);
    }

    .faq-title {
      color: var(--color-black) !important;
      text-align: center !important;
      margin-bottom: 3rem !important;
    }

    .faq-item {
      border: none !important;
      border-bottom: 2px solid var(--color-black) !important;
      border-radius: 0 !important;
      background: transparent !important;
      box-shadow: none !important;
    }

    .faq-question {
      font-family: var(--font-display) !important;
      font-weight: 600 !important;
      font-size: 1.125rem !important;
      color: var(--color-black) !important;
      padding: 1.5rem 0 !important;
    }

    .faq-question::after {
      content: "+" !important;
      font-size: 2rem !important;
      color: var(--color-black) !important;
    }

    .faq-item[open] .faq-question::after {
      content: "−" !important;
    }

    .faq-answer {
      background: transparent !important;
      padding: 0 0 1.5rem 0 !important;
      border-top: none !important;
    }

    .faq-answer p {
      color: var(--color-charcoal) !important;
      font-size: 1rem;
      line-height: 1.7;
    }
  </style>

  <!-- Hero Section with Image -->
  <section class="bg-cream relative min-h-[60vh] flex items-center">
    <div class="container py-12">
      <div class="grid lg:grid-cols-2 gap-12 items-center">
        <!-- Left side - Image (swapped from service layout) -->
        {heroImage && (
          <div class="relative order-1 lg:order-1">
            <img
              src={heroImage}
              alt={`Commercial cleaning in ${city}, TX`}
              class="w-full h-[400px] object-cover border-2 border-black"
              loading="lazy"
            />
          </div>
        )}

        <!-- Right side - Content -->
        <div class={heroImage ? 'order-2 lg:order-2' : 'order-1 lg:order-2'}>
          <!-- Breadcrumbs -->
          <Breadcrumbs breadcrumbs={breadcrumbs} />

          <p class="text-sm uppercase tracking-widest mb-4 text-gray-600">
            {county}
          </p>
          <h1 class="mb-6">
            <span class="block">Commercial Cleaning in</span>
            <span class="block serif-italic text-accent">{city}, Texas</span>
          </h1>
          <p class="text-lg text-gray-600 mb-8 max-w-xl">
            Professional commercial cleaning services in {city}, TX. Licensed, bonded, and insured.
          </p>
          <div class="flex flex-col sm:flex-row gap-4">
            <a href="#contact-form" class="btn-primary-custom">
              Get Your Free Quote
            </a>
            <a href={`tel:${siteData.phone.replace(/\D/g, '')}`} class="btn-secondary-custom">
              Call {siteData.phone}
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content with Sidebar -->
  <article class="bg-white border-t-2 border-black">
    <div class="container py-16">
      <div class="grid lg:grid-cols-3 gap-12">
        <!-- Main Content -->
        <div class="lg:col-span-2 location-content">
          <slot />
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1">
          <div class="sidebar-scroll-container sticky top-24">
            <!-- Contact Form -->
            <div id="contact-form" class="bg-cream border-2 border-black p-6 mb-6">
              <h2 class="text-2xl font-bold text-black mb-4">Request a Quote</h2>
              <ContactForm client:load prefillProjectType="Other" />
            </div>

            <!-- Nearby Locations -->
            {relatedLocations.length > 0 && (
              <div class="bg-cream border-2 border-black p-6">
                <h3 class="text-xl font-bold text-black mb-4">Nearby Areas</h3>
                <ul class="space-y-2">
                  {relatedLocations.map(loc => (
                    <li>
                      <a
                        href={`/locations/${loc.slug}`}
                        class="text-primary hover:text-accent transition-colors"
                      >
                        {loc.title}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  </article>

  <!-- Related Services -->
  {relatedServices.length > 0 && (
    <section class="bg-cream py-16 border-t border-black">
      <div class="container">
        <h2 class="text-3xl font-bold text-black mb-8">Services We Offer in {city}</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {relatedServices.map(service => (
            <a
              href={`/services/${service.slug}`}
              class="block bg-white border-2 border-black p-6 hover:shadow-lg transition-shadow"
            >
              <h3 class="text-xl font-bold text-black mb-2">{service.title}</h3>
              <p class="text-text-light">{service.description}</p>
              <span class="inline-block mt-4 text-accent font-semibold">Learn More →</span>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- FAQ Section -->
  <FAQ faqs={faqs} title={`Frequently Asked Questions About ${city} Commercial Cleaning`} />

  <!-- CTA Section -->
  <section class="py-20 md:py-28 bg-cream">
    <div class="container text-center">
      <h2 class="text-3xl md:text-5xl font-bold leading-tight mb-6">
        Professional Commercial Cleaning Dallas Businesses Depend On
      </h2>
      <p class="text-xl text-gray-600 mb-10 max-w-2xl mx-auto">
        Contact us today for a free quote. We're ready to help you maintain a clean, professional facility that reflects well on your business.
      </p>
      <a href="#contact-form" class="btn-primary-custom inline-flex items-center justify-center gap-3 scroll-smooth">
        Get Your Free Quote
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </section>

  <style is:global>
    /* Sidebar scroll container */
    .sidebar-scroll-container {
      max-height: calc(100vh - 12rem);
      overflow-y: auto;
      position: sticky;
      top: 6rem;
    }

    @media (max-width: 1024px) {
      .sidebar-scroll-container {
        position: static;
        max-height: none;
        overflow-y: visible;
      }
    }

    /* Location content styling */
    .location-content {
      font-family: var(--font-display);
      color: var(--color-black);
      line-height: 1.7;
    }

    .location-content p {
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    .location-content h2 {
      font-size: 2rem;
      font-weight: 700;
      color: var(--color-black);
      margin-top: 2.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 3px double var(--color-accent);
    }

    .location-content h3 {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--color-black);
      margin-top: 2rem;
      margin-bottom: 0.75rem;
      padding-left: 1rem;
      border-left: 4px solid var(--color-accent);
    }

    .location-content ul {
      list-style: none;
      padding-left: 0;
      margin-bottom: 1.5rem;
    }

    .location-content ul li {
      padding-left: 1.5rem;
      margin-bottom: 0.5rem;
      position: relative;
    }

    .location-content ul li::before {
      content: '✓';
      position: absolute;
      left: 0;
      color: var(--color-accent);
      font-weight: bold;
      font-size: 1.2rem;
    }

    .location-content a {
      color: var(--color-black);
      text-decoration: underline;
    }

    .location-content a:hover {
      color: var(--color-accent);
    }

    .location-content strong {
      color: var(--color-black);
      font-weight: 600;
    }

    /* Primary color override */
    .text-primary {
      color: var(--color-accent);
    }
  </style>
</BaseLayout>