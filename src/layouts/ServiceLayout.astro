---
/**
 * Service Layout
 * Layout for all service pages with breadcrumbs, schema, sidebar form, and related services
 */
import BaseLayout from './BaseLayout.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';
import Schema from '../components/Schema.astro';
import FAQ from '../components/FAQ.astro';
import RelatedServices from '../components/RelatedServices.astro';
import ContactForm from '../components/ContactForm';

interface Props {
  title: string;
  description: string;
  serviceName: string;
  targetKeyword: string;
  faqs: Array<{ question: string; answer: string }>;
  relatedServices?: Array<{ slug: string; title: string; description: string }>;
  parentPage?: string;
  heroImage?: string;
}

const {
  title,
  description,
  serviceName,
  targetKeyword,
  faqs,
  relatedServices = [],
  parentPage = 'Services',
  heroImage,
} = Astro.props;

const servicesData = (await import('../data/services.json')).default;
const siteData = (await import('../data/site.json')).default;

// Generate breadcrumbs
const breadcrumbs = [
  { name: 'Home', url: '/' },
  { name: parentPage, url: '/services' },
  { name: serviceName, url: Astro.url.pathname },
];

// Generate service schema
const serviceSchemaData = {
  serviceType: serviceName,
  description: description,
  name: title,
};

// Get related services if not provided
const getRelatedServices = () => {
  if (relatedServices.length > 0) {
    return relatedServices;
  }

  // Find related services based on category (excluding current service)
  const currentSlug = Astro.url.pathname.split('/').pop();
  const currentService = servicesData.find((s) => s.slug === currentSlug);

  if (currentService) {
    return servicesData
      .filter((s) => s.slug !== currentSlug && s.category === currentService.category)
      .slice(0, 4)
      .map((s) => ({
        slug: s.slug,
        title: s.title,
        description: s.description,
      }));
  }

  // Fallback: return first 4 services (excluding current)
  return servicesData
    .filter((s) => s.slug !== currentSlug)
    .slice(0, 4)
    .map((s) => ({
      slug: s.slug,
      title: s.title,
      description: s.description,
    }));
};
---

<BaseLayout title={title} description={description}>
  <!-- Schema Markup -->
  <Schema type="service" data={serviceSchemaData} />
  <Schema type="faqPage" data={{ faqs }} />
  <Schema type="breadcrumb" data={{ breadcrumbs }} />

  <style is:global>
    /* Override FAQ styling to match homepage */
    .faq-section {
      background: white !important;
      border-top: 2px solid var(--color-black);
      border-bottom: 2px solid var(--color-black);
    }

    .faq-title {
      color: var(--color-black) !important;
      text-align: center !important;
      margin-bottom: 3rem !important;
    }

    .faq-item {
      border: none !important;
      border-bottom: 2px solid var(--color-black) !important;
      border-radius: 0 !important;
      background: transparent !important;
      box-shadow: none !important;
    }

    .faq-question {
      font-family: var(--font-display) !important;
      font-weight: 600 !important;
      font-size: 1.125rem !important;
      color: var(--color-black) !important;
      padding: 1.5rem 0 !important;
    }

    .faq-question::after {
      content: "+" !important;
      font-size: 2rem !important;
      color: var(--color-black) !important;
    }

    .faq-item[open] .faq-question::after {
      content: "−" !important;
    }

    .faq-answer {
      background: transparent !important;
      padding: 0 0 1.5rem 0 !important;
      border-top: none !important;
    }

    .faq-answer p {
      color: var(--color-charcoal) !important;
      font-size: 1rem;
      line-height: 1.7;
    }
  </style>

  <!-- Hero Section -->
  <section class="bg-cream relative min-h-[60vh] flex items-center">
    <div class="container py-12">
      <div class="grid lg:grid-cols-2 gap-12 items-center">
        <!-- Left side - Content -->
        <div>
          <!-- Breadcrumbs -->
          <Breadcrumbs breadcrumbs={breadcrumbs} />

          <p class="text-sm uppercase tracking-widest mb-4 text-gray-600">
            {serviceName}
          </p>
          <h1 class="mb-6">
            <span class="block">{serviceName} in</span>
            <span class="block serif-italic text-accent">Dallas, Texas</span>
          </h1>
          <p class="text-lg text-gray-600 mb-8 max-w-xl">
            Professional {targetKeyword.toLowerCase()} for Dallas area businesses.
          </p>
          <div class="flex flex-col sm:flex-row gap-4">
            <a href="#contact-form" class="btn-primary-custom scroll-smooth">
              Get Your Free Quote
            </a>
            <a href={`tel:${siteData.phone.replace(/\D/g, '')}`} class="btn-secondary-custom">
              Call {siteData.phone}
            </a>
          </div>
        </div>

        <!-- Right side - Image -->
        {heroImage && (
          <div class="relative">
            <img
              src={heroImage}
              alt={`${serviceName} in Dallas`}
              class="w-full h-[400px] object-cover border-2 border-black"
              loading="lazy"
            />
          </div>
        )}
      </div>
    </div>
  </section>

  <!-- Main Content with Sidebar -->
  <article class="bg-white border-t-2 border-black">
    <div class="container py-16">
      <div class="grid lg:grid-cols-3 gap-12">
        <!-- Main Content -->
        <div class="lg:col-span-2 service-content">
          <slot />
        </div>

        <!-- Independent Scroll Sidebar -->
        <aside class="hidden lg:block">
          <div class="sidebar-scroll-container">
            <!-- Contact Form -->
            <div id="contact-form" class="contact-form-box">
              <h3 class="sidebar-title">Get Your Free Quote</h3>
              <p class="sidebar-subtitle">Tell us about your cleaning needs</p>

              <ContactForm client:load prefillProjectType={serviceName} />

              <!-- Quick Contact -->
              <div class="sidebar-quick-contact">
                <p class="sidebar-contact-text">Prefer to call?</p>
                <a href={`tel:${siteData.phone.replace(/\D/g, '')}`} class="sidebar-phone">
                  {siteData.phone}
                </a>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </article>

  <!-- CTA Section -->
  <section class="bg-accent border-t-2 border-b-2 border-black py-16">
    <div class="container max-w-4xl text-center">
      <h2 class="text-cream mb-6">
        Ready for Professional {serviceName}?
      </h2>
      <p class="text-cream/90 text-lg mb-8 max-w-2xl mx-auto">
        Contact us today for a free, customized quote tailored to your facility needs.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a href="#contact-form" class="btn-primary-custom bg-white text-black hover:bg-black hover:text-cream scroll-smooth">
          Request Your Free Quote
        </a>
        <a href={`tel:${siteData.phone.replace(/\D/g, '')}`} class="btn-secondary-custom border-white text-white hover:bg-white hover:text-black">
          Call {siteData.phone}
        </a>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <FAQ faqs={faqs} title={`Frequently Asked Questions About ${serviceName}`} />

  <!-- Related Services -->
  {getRelatedServices().length > 0 && (
    <RelatedServices services={getRelatedServices()} />
  )}

</BaseLayout>

<style>
  .service-content {
    font-family: var(--font-display);
  }

  /* Section dividers */
  .service-content :global(h2) {
    color: var(--color-black);
    margin-top: 4rem;
    margin-bottom: 2rem;
    font-weight: 600;
    padding-bottom: 1rem;
    border-bottom: 3px solid var(--color-accent);
    position: relative;
  }

  .service-content :global(h2)::after {
    content: '';
    position: absolute;
    bottom: -3px;
    left: 0;
    width: 80px;
    height: 3px;
    background: var(--color-black);
  }

  .service-content :global(h3) {
    color: var(--color-black);
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .service-content :global(h3)::before {
    content: '';
    display: inline-block;
    width: 8px;
    height: 8px;
    background: var(--color-accent);
    border-radius: 50%;
    flex-shrink: 0;
  }

  /* Paragraphs with better spacing */
  .service-content :global(p) {
    color: var(--color-charcoal);
    line-height: 1.8;
    margin-bottom: 1.5rem;
    font-size: 1.125rem;
  }

  /* Styled lists with checkmarks */
  .service-content :global(ul),
  .service-content :global(ol) {
    margin-bottom: 2rem;
    padding-left: 0;
    color: var(--color-charcoal);
  }

  .service-content :global(ul) {
    list-style: none;
  }

  .service-content :global(li) {
    margin-bottom: 1rem;
    line-height: 1.7;
    font-size: 1.125rem;
    padding-left: 2rem;
    position: relative;
  }

  .service-content :global(ul li)::before {
    content: '✓';
    position: absolute;
    left: 0;
    color: var(--color-accent);
    font-weight: 700;
    font-size: 1.25rem;
    top: -2px;
  }

  .service-content :global(ol) {
    padding-left: 2rem;
    list-style: none;
    counter-reset: item;
  }

  .service-content :global(ol li) {
    counter-increment: item;
  }

  .service-content :global(ol li)::before {
    content: counter(item) '.';
    position: absolute;
    left: 0;
    color: var(--color-black);
    font-weight: 700;
    font-size: 1.125rem;
  }

  /* Links styled prominently */
  .service-content :global(a) {
    color: var(--color-accent);
    text-decoration: underline;
    text-underline-offset: 2px;
    text-decoration-thickness: 2px;
    transition: all 0.2s;
    font-weight: 600;
  }

  .service-content :global(a:hover) {
    color: var(--color-black);
    text-decoration-color: var(--color-black);
  }

  /* Bold text stands out */
  .service-content :global(strong) {
    font-weight: 700;
    color: var(--color-black);
    background: linear-gradient(180deg, transparent 60%, rgba(200, 85, 45, 0.15) 60%);
  }

  /* Highlight boxes for key points */
  .service-content :global(.highlight-box) {
    background: var(--color-cream);
    border-left: 4px solid var(--color-accent);
    padding: 1.5rem;
    margin: 2rem 0;
    border-radius: 0 0.5rem 0.5rem 0;
  }

  .service-content :global(.highlight-box p) {
    margin-bottom: 0;
  }

  /* Sidebar Styles */
  .sidebar-scroll-container {
    max-height: calc(100vh - 12rem);
    overflow-y: auto;
    position: sticky;
    top: 6rem;
    padding-right: 0.5rem;
    scrollbar-width: thin;
    scrollbar-color: var(--color-accent) var(--color-cream);
  }

  .sidebar-scroll-container::-webkit-scrollbar {
    width: 6px;
  }

  .sidebar-scroll-container::-webkit-scrollbar-track {
    background: var(--color-cream);
    border-radius: 3px;
  }

  .sidebar-scroll-container::-webkit-scrollbar-thumb {
    background: var(--color-accent);
    border-radius: 3px;
  }

  .sidebar-scroll-container::-webkit-scrollbar-thumb:hover {
    background: var(--color-black);
  }

  .contact-form-box {
    background: var(--color-cream);
    border: 2px solid var(--color-black);
    padding: 2rem;
    box-shadow: 4px 4px 0 rgba(10, 10, 10, 0.1);
  }

  .sidebar-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-black);
    margin-bottom: 0.5rem;
  }

  .sidebar-subtitle {
    color: var(--color-charcoal);
    font-size: 0.875rem;
    margin-bottom: 1.5rem;
  }

  .form-group {
    margin-bottom: 1.25rem;
  }

  .form-label {
    display: block;
    font-weight: 600;
    font-size: 0.875rem;
    margin-bottom: 0.5rem;
    color: var(--color-black);
  }

  .form-input,
  .form-select,
  .form-textarea {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid var(--color-black);
    border-radius: 0.25rem;
    font-family: var(--font-display);
    font-size: 0.875rem;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px rgba(200, 85, 45, 0.1);
  }

  .form-hint {
    display: block;
    font-size: 0.75rem;
    color: #666;
    margin-top: 0.25rem;
  }

  .form-submit {
    width: 100%;
    padding: 1rem;
    background: var(--color-black);
    color: var(--color-cream);
    font-weight: 600;
    font-family: var(--font-display);
    border: none;
    border-radius: 0.25rem;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 1rem;
  }

  .form-submit:hover {
    background: var(--color-accent);
    transform: translateY(-2px);
  }

  .form-notice {
    text-align: center;
    font-size: 0.75rem;
    color: var(--color-charcoal);
    margin-top: 1rem;
  }

  .sidebar-quick-contact {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--color-black);
    text-align: center;
  }

  .sidebar-contact-text {
    font-size: 0.875rem;
    color: var(--color-charcoal);
    margin-bottom: 0.5rem;
  }

  .sidebar-phone {
    display: block;
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-accent);
    text-decoration: none;
    transition: color 0.2s;
  }

  .sidebar-phone:hover {
    color: var(--color-black);
  }

  @media (max-width: 1024px) {
    .sidebar-sticky {
      position: static;
    }
  }
</style>
